[{"filePath":"G:\\Users\\daveq\\qcode\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\scripts\\migrate.js","messages":[{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":5,"column":12,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":5,"endColumn":25},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":6,"column":14,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":6,"endColumn":29},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":7,"column":18,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":7,"endColumn":31},{"ruleId":"@typescript-eslint/no-require-imports","severity":2,"message":"A `require()` style import is forbidden.","line":10,"column":36,"nodeType":"CallExpression","messageId":"noRequireImports","endLine":10,"endColumn":80}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/*\n  Simple migration runner for Postgres.\n  Uses DATABASE_URL if set, else supports Cloud SQL socket via env vars.\n*/\nconst fs = require('fs');\nconst path = require('path');\nconst { Pool } = require('pg');\nlet Connector, IpAddressTypes;\ntry {\n  ({ Connector, IpAddressTypes } = require('@google-cloud/cloud-sql-connector'));\n} catch {}\n\nasync function createPool() {\n  const databaseUrl = process.env.DATABASE_URL;\n  if (databaseUrl) {\n    return new Pool({\n      connectionString: databaseUrl,\n      ssl: /sslmode=require|\\?ssl=true/i.test(databaseUrl) ? { rejectUnauthorized: false } : undefined,\n      max: 1,\n    });\n  }\n\n  const instanceConnectionName = process.env.INSTANCE_CONNECTION_NAME;\n  const dbUser = process.env.DB_USER || 'postgres';\n  const dbPassword = process.env.DB_PASSWORD || '';\n  const dbName = process.env.DB_NAME || 'postgres';\n\n  if (!instanceConnectionName) {\n    return new Pool({\n      host: process.env.DB_HOST || '127.0.0.1',\n      port: Number(process.env.DB_PORT || 5432),\n      user: dbUser,\n      password: dbPassword,\n      database: dbName,\n      max: 1,\n    });\n  }\n  // Prefer Cloud SQL Connector if available\n  if (Connector && IpAddressTypes) {\n    const connector = new Connector();\n    const opts = await connector.getOptions({ instanceConnectionName, ipType: IpAddressTypes.PUBLIC });\n    return new Pool({ ...opts, user: dbUser, password: dbPassword, database: dbName, max: 1 });\n  }\n  // Fallback to mounted Unix domain socket path\n  return new Pool({ host: `/cloudsql/${instanceConnectionName}`,\n    user: dbUser, password: dbPassword, database: dbName, max: 1 });\n}\n\nasync function main() {\n  const pool = await createPool();\n  const sqlPath = path.join(__dirname, 'migrate.sql');\n  const sql = fs.readFileSync(sqlPath, 'utf8');\n  try {\n    await pool.query(sql);\n    console.log('Migration applied');\n  } finally {\n    await pool.end();\n  }\n}\n\nmain().catch((err) => {\n  console.error('Migration failed:', err);\n  process.exit(1);\n});\n","usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\admin\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\admin\\import\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\auth\\check\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\auth\\login\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\auth\\logout\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\projects\\[id]\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\projects\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\api\\sheets\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\AdminLogin.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\Button.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\ErrorBoundary.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\ProjectCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\ProjectCards.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\ProjectForm.tsx","messages":[],"suppressedMessages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":231,"column":19,"nodeType":"JSXOpeningElement","endLine":231,"endColumn":114,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\ProjectsSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'localOnly' is assigned a value but never used.","line":190,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":190,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'showToast'. Either include it or remove the dependency array.","line":404,"column":6,"nodeType":"ArrayExpression","endLine":404,"endColumn":49,"suggestions":[{"desc":"Update the dependencies array to be: [editingProject, items, showToast, saveLocal, isAdmin]","fix":{"range":[13881,13924],"text":"[editingProject, items, showToast, saveLocal, isAdmin]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'showToast'. Either include it or remove the dependency array.","line":449,"column":6,"nodeType":"ArrayExpression","endLine":449,"endColumn":58,"suggestions":[{"desc":"Update the dependencies array to be: [items, saveLocal, editingProject?.id, showToast, handleCancelEdit]","fix":{"range":[15389,15441],"text":"[items, saveLocal, editingProject?.id, showToast, handleCancelEdit]"}}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'err' is defined but never used.","line":537,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":537,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\nimport React, { useEffect, useMemo, useState, useCallback } from \"react\";\nimport ProjectCard from \"@/components/ProjectCard\";\nimport Toast from \"@/components/Toast\";\nimport AdminLogin from \"@/components/AdminLogin\";\nimport ProjectForm, { ProjectFormData } from \"@/components/ProjectForm\";\nimport Button from \"@/components/Button\";\nimport ErrorBoundary from \"@/components/ErrorBoundary\";\nimport { projects as defaultProjects } from \"@/data/projects\";\nimport { Project, AuthResponse, LoginResponse } from \"@/types/project\";\nimport { STORAGE_KEY } from \"@/lib/constants\";\nimport {\n  DndContext,\n  closestCenter,\n  KeyboardSensor,\n  PointerSensor,\n  useSensor,\n  useSensors,\n  DragEndEvent,\n} from '@dnd-kit/core';\nimport {\n  arrayMove,\n  SortableContext,\n  sortableKeyboardCoordinates,\n  verticalListSortingStrategy,\n  useSortable,\n} from '@dnd-kit/sortable';\nimport { CSS } from '@dnd-kit/utilities';\n\ntype SortableProjectCardProps = {\n  project: Project;\n  isAdmin: boolean;\n  onEdit: (project: Project) => void;\n  onDelete: (id: string) => void;\n};\n\nfunction SortableProjectCard({ project, isAdmin, onEdit, onDelete }: SortableProjectCardProps) {\n  const {\n    attributes,\n    listeners,\n    setNodeRef,\n    transform,\n    transition,\n    isDragging,\n  } = useSortable({ id: project.id });\n\n  const style = {\n    transform: CSS.Transform.toString(transform),\n    transition,\n    opacity: isDragging ? 0.5 : 1,\n  };\n\n  return (\n    <div ref={setNodeRef} style={style} className=\"relative\">\n      {isAdmin && (\n        <div\n          {...attributes}\n          {...listeners}\n          className=\"absolute top-2 left-2 z-10 cursor-grab active:cursor-grabbing bg-slate-700/80 hover:bg-slate-600/80 backdrop-blur-sm rounded-lg p-2 border border-slate-600\"\n          title=\"Drag to reorder\"\n          role=\"button\"\n          aria-label=\"Drag to reorder project\"\n        >\n          <svg className=\"w-4 h-4 text-slate-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\" aria-hidden=\"true\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n          </svg>\n        </div>\n      )}\n      <ProjectCard\n        title={project.title}\n        url={project.url}\n        description={project.description}\n        tags={project.tags}\n        imageUrl={project.imageUrl}\n        images={project.images}\n      />\n      {isAdmin && (\n        <div className=\"absolute top-2 right-2 flex gap-1\">\n          <button\n            onClick={() => onEdit(project)}\n            className=\"text-xs px-2 py-1 rounded bg-blue-500/30 hover:bg-blue-500/40 border border-blue-500/40\"\n            title=\"Edit local project\"\n            aria-label={`Edit ${project.title}`}\n          >\n            Edit\n          </button>\n          <button\n            onClick={() => onDelete(project.id)}\n            className=\"text-xs px-2 py-1 rounded bg-red-500/30 hover:bg-red-500/40 border border-red-500/40\"\n            title=\"Delete local project\"\n            aria-label={`Delete ${project.title}`}\n          >\n            Delete\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nconst MemoizedSortableProjectCard = React.memo(SortableProjectCard);\n\nexport default function ProjectsSection() {\n  const [items, setItems] = useState<Project[]>([]);\n  const [showForm, setShowForm] = useState(false);\n  const [editingProject, setEditingProject] = useState<Project | null>(null);\n  const [isAdmin, setIsAdmin] = useState(false);\n  const [showAdminLogin, setShowAdminLogin] = useState(false);\n  const [toast, setToast] = useState<{ message: string; type?: \"success\" | \"info\" | \"error\" } | null>(null);\n  const [importToServer, setImportToServer] = useState(false);\n\n  const showToast = useCallback((message: string, type?: \"success\" | \"info\" | \"error\") => {\n    setToast({ message, type });\n  }, []);\n  // No longer prompting for token; rely on admin session cookie\n\n  const sensors = useSensors(\n    useSensor(PointerSensor),\n    useSensor(KeyboardSensor, {\n      coordinateGetter: sortableKeyboardCoordinates,\n    })\n  );\n\n  // Check auth status on mount\n  useEffect(() => {\n    fetch('/api/auth/check', { credentials: 'include' })\n      .then(r => r.json())\n      .then((data: AuthResponse) => {\n        if (data.authenticated) {\n          setIsAdmin(true);\n        }\n      })\n      .catch(() => {\n        // Ignore errors\n      });\n  }, []);\n\n  // Token no longer required for UI actions\n\n  // Load projects on mount\n  useEffect(() => {\n    const defaults: Project[] = defaultProjects.map((p, i) => ({\n      id: `default-${i}`,\n      title: p.title,\n      url: p.url,\n      description: p.description,\n      tags: p.tags,\n      imageUrl: p.imageUrl || \"\",\n      source: \"default\" as const,\n    }));\n\n    // Start with local projects for backward compatibility\n    try {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      const local: Project[] = raw ? JSON.parse(raw) : [];\n      setItems([...local, ...defaults]);\n    } catch {\n      setItems(defaults);\n    }\n\n    // Fetch server-side projects and merge on top\n    fetch(\"/api/projects\")\n      .then((r) => r.json())\n      .then((server: unknown) => {\n        const serverArray = Array.isArray(server) ? server : [];\n        const serverMapped: Project[] = serverArray.map((p: unknown, i) => {\n          const proj = p as Record<string, unknown>;\n          return {\n            id: String(proj.id ?? `srv-${i}`),\n            title: String(proj.title ?? \"\"),\n            url: String(proj.url ?? \"\"),\n            description: String(proj.description ?? \"\"),\n            tags: Array.isArray(proj.tags) ? proj.tags.map(String) : [],\n            imageUrl: proj.imageUrl ? String(proj.imageUrl) : \"\",\n            source: \"server\" as const,\n          };\n        });\n        setItems((prev) => [...serverMapped, ...prev.filter((x) => x.source !== \"default\"), ...defaults]);\n      })\n      .catch(() => {\n        // ignore fetch errors silently\n      });\n  }, []);\n\n  // When admin status changes, default import target accordingly\n  useEffect(() => {\n    setImportToServer(isAdmin);\n  }, [isAdmin]);\n\n  const localOnly = useMemo(() => items.filter((i) => i.source === \"local\"), [items]);\n\n  const saveLocal = useCallback((list: Project[]) => {\n    const onlyLocal = list.filter((i) => i.source === \"local\");\n    const dataString = JSON.stringify(onlyLocal);\n    const sizeInMB = new Blob([dataString]).size / (1024 * 1024);\n\n    try {\n      localStorage.setItem(STORAGE_KEY, dataString);\n    } catch (err) {\n      if (err instanceof Error && err.name === 'QuotaExceededError') {\n        alert(\n          `Storage quota exceeded! Your projects data is ${sizeInMB.toFixed(2)}MB.\\n\\n` +\n          `Tips to reduce size:\\n` +\n          `‚Ä¢ Use smaller image files (under 500KB each)\\n` +\n          `‚Ä¢ Use image URLs instead of uploading\\n` +\n          `‚Ä¢ Delete old projects you don't need\\n` +\n          `‚Ä¢ Consider using the Google Sheets integration for backup`\n        );\n        throw err;\n      }\n      throw err;\n    }\n  }, []);\n\n  const handleLogin = useCallback(async (password: string) => {\n    const response = await fetch('/api/auth/login', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      credentials: 'include',\n      body: JSON.stringify({ password }),\n    });\n    const data: LoginResponse = await response.json();\n\n    if (response.ok && data.success) {\n      setIsAdmin(true);\n      setShowAdminLogin(false);\n    } else {\n      alert(data.error || \"Incorrect password\");\n      throw new Error(data.error || \"Login failed\");\n    }\n  }, []);\n\n  const handleLogout = useCallback(async () => {\n    try {\n      await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });\n    } catch {\n      // Ignore errors\n    }\n    setIsAdmin(false);\n  }, []);\n\n  const handleSaveToSheets = useCallback(async (data: ProjectFormData): Promise<boolean> => {\n    try {\n      const res = await fetch(\"/api/sheets\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          title: data.title.trim(),\n          url: data.url.trim(),\n          description: data.description.trim(),\n          tags: data.tags.split(\",\").map((t) => t.trim()).filter(Boolean),\n          imageUrl: data.images[0] || \"\",\n          images: data.images.filter(Boolean),\n        }),\n      });\n\n      const result = await res.json();\n      if (!res.ok) {\n        throw new Error(result.error || \"Failed to save to Google Sheets\");\n      }\n      return true;\n    } catch (err: unknown) {\n      const message = err instanceof Error ? err.message : \"Failed to save to Google Sheets\";\n      alert(`Error: ${message}`);\n      return false;\n    }\n  }, []);\n\n  const handleSaveProject = useCallback(async (data: ProjectFormData) => {\n    const validImages = data.images.filter(Boolean);\n\n    if (editingProject) {\n      // Update existing project\n      if (editingProject.source === \"server\") {\n        try {\n          const payload = {\n            title: data.title.trim(),\n            url: data.url.trim(),\n            description: data.description.trim(),\n            tags: data.tags.split(\",\").map((t) => t.trim()).filter(Boolean),\n            imageUrl: validImages[0] || \"\",\n          };\n          const res = await fetch(`/api/projects/${editingProject.id}`, {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'application/json',\n            },\n            credentials: 'include',\n            body: JSON.stringify(payload),\n          });\n          if (!res.ok) {\n            const j: Record<string, unknown> = await res.json().catch(() => ({} as Record<string, unknown>));\n            const msg = typeof (j as { error?: unknown }).error === 'string'\n              ? ((j as { error?: unknown }).error as string)\n              : `Update failed (${res.status})`;\n            throw new Error(msg);\n          }\n          const updated = await res.json();\n          const next = items.map((it) => it.id === editingProject.id\n            ? { ...it, ...updated, source: 'server' as const }\n            : it);\n          setItems(next);\n          showToast('Updated on server', 'success');\n        } catch (err) {\n          alert(err instanceof Error ? err.message : \"Failed to update server project\");\n          return;\n        }\n      } else {\n        const next = items.map((item) =>\n          item.id === editingProject.id\n            ? {\n                ...item,\n                title: data.title.trim(),\n                url: data.url.trim(),\n                description: data.description.trim(),\n                tags: data.tags.split(\",\").map((t) => t.trim()).filter(Boolean),\n                images: validImages,\n                imageUrl: validImages[0] || \"\",\n              }\n            : item\n        );\n        setItems(next);\n        saveLocal(next);\n        showToast('Updated (local)', 'info');\n      }\n    } else {\n      // Add new project\n      const payload = {\n        title: data.title.trim(),\n        url: data.url.trim(),\n        description: data.description.trim(),\n        tags: data.tags,\n        imageUrl: validImages[0] || \"\",\n      };\n\n      if (isAdmin) {\n        // Persist on server when logged in as admin\n        try {\n          const res = await fetch('/api/projects', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            credentials: 'include',\n            body: JSON.stringify(payload),\n          });\n          if (!res.ok) {\n            const j: Record<string, unknown> = await res.json().catch(() => ({} as Record<string, unknown>));\n            const msg = typeof (j as { error?: unknown }).error === 'string'\n              ? ((j as { error?: unknown }).error as string)\n              : `Create failed (${res.status})`;\n            throw new Error(msg);\n          }\n          const created = await res.json();\n          const newServer: Project = {\n            id: String(created.id),\n            title: String(created.title),\n            url: String(created.url),\n            description: String(created.description || ''),\n            tags: Array.isArray(created.tags) ? created.tags.map(String) : data.tags.split(',').map((t)=>t.trim()).filter(Boolean),\n            imageUrl: created.imageUrl ? String(created.imageUrl) : (validImages[0] || ''),\n            images: validImages,\n            source: 'server',\n          };\n          setItems((prev) => [newServer, ...prev]);\n          showToast('Saved to server', 'success');\n        } catch (err) {\n          // Fallback to local if server add fails\n          alert(err instanceof Error ? err.message : 'Failed to add on server; saving locally.');\n          const newItem: Project = {\n            id: `local-${crypto.randomUUID()}`,\n            title: payload.title,\n            url: payload.url,\n            description: payload.description,\n            tags: data.tags.split(',').map((t)=>t.trim()).filter(Boolean),\n            images: validImages,\n            imageUrl: payload.imageUrl,\n            source: 'local',\n          };\n          const next = [newItem, ...items];\n          setItems(next);\n          saveLocal(next);\n          showToast('Saved locally (server unavailable)', 'info');\n        }\n      } else {\n        // Not admin: keep client-side only\n        const newItem: Project = {\n          id: `local-${crypto.randomUUID()}`,\n          title: payload.title,\n          url: payload.url,\n          description: payload.description,\n          tags: data.tags.split(',').map((t)=>t.trim()).filter(Boolean),\n          images: validImages,\n          imageUrl: payload.imageUrl,\n          source: 'local',\n        };\n        const next = [newItem, ...items];\n        setItems(next);\n        saveLocal(next);\n        showToast('Saved locally', 'info');\n      }\n    }\n\n    setEditingProject(null);\n    setShowForm(false);\n  }, [editingProject, items, isAdmin, saveLocal]);\n\n  const handleEdit = useCallback((project: Project) => {\n    setEditingProject(project);\n    setShowForm(true);\n  }, []);\n\n  const handleCancelEdit = useCallback(() => {\n    setEditingProject(null);\n    setShowForm(false);\n  }, []);\n\n  const handleDelete = useCallback(async (id: string) => {\n    if (!confirm(\"Delete this project?\")) return;\n    const current = items.find((i) => i.id === id);\n    if (current?.source === 'server') {\n      try {\n        const res = await fetch(`/api/projects/${id}`, {\n          method: 'DELETE',\n          // session cookie carries admin auth\n          headers: {},\n          credentials: 'include',\n        });\n        if (!res.ok) {\n          const j: Record<string, unknown> = await res.json().catch(() => ({} as Record<string, unknown>));\n          const msg = typeof (j as { error?: unknown }).error === 'string'\n            ? ((j as { error?: unknown }).error as string)\n            : `Delete failed (${res.status})`;\n          throw new Error(msg);\n        }\n        showToast('Deleted from server', 'success');\n      } catch (err) {\n        alert(err instanceof Error ? err.message : \"Failed to delete server project\");\n        return;\n      }\n    }\n    const next = items.filter((i) => i.id !== id);\n    setItems(next);\n    saveLocal(next);\n    if (editingProject?.id === id) {\n      handleCancelEdit();\n    }\n    if (!current || current.source !== 'server') {\n      showToast('Deleted (local)', 'info');\n    }\n  }, [items, editingProject, saveLocal, handleCancelEdit]);\n\n  const handleClearLocal = useCallback(() => {\n    if (!confirm(\"Remove all local projects from this browser?\")) return;\n    const next = items.filter((i) => i.source !== \"local\");\n    setItems(next);\n    saveLocal(next);\n  }, [items, saveLocal]);\n\n  const handleDragEnd = useCallback((event: DragEndEvent) => {\n    const { active, over } = event;\n\n    if (over && active.id !== over.id) {\n      setItems((items) => {\n        const oldIndex = items.findIndex((item) => item.id === active.id);\n        const newIndex = items.findIndex((item) => item.id === over.id);\n        const newItems = arrayMove(items, oldIndex, newIndex);\n        saveLocal(newItems);\n        return newItems;\n      });\n    }\n  }, [saveLocal]);\n\n  const handleExport = useCallback(() => {\n    const localProjects = items.filter((i) => i.source === \"local\");\n    const dataStr = JSON.stringify(localProjects, null, 2);\n    const dataBlob = new Blob([dataStr], { type: 'application/json' });\n    const url = URL.createObjectURL(dataBlob);\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = `qcode-projects-${new Date().toISOString().split('T')[0]}.json`;\n    link.click();\n    URL.revokeObjectURL(url);\n  }, [items]);\n\n  const handleImport = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    const reader = new FileReader();\n    reader.onload = async (event) => {\n      try {\n        const imported = JSON.parse(event.target?.result as string) as unknown;\n\n        if (isAdmin && importToServer) {\n          // As admin, import directly to server to persist data\n          const body = Array.isArray(imported) ? imported : { projects: imported };\n          const res = await fetch('/api/admin/import', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            credentials: 'include',\n            body: JSON.stringify(body),\n          });\n          const j = await res.json().catch(() => ({} as Record<string, unknown>));\n          if (!res.ok) throw new Error((j as { error?: string }).error || `Import failed (${res.status})`);\n\n          // Refresh from server\n          const serverRes = await fetch('/api/projects', { credentials: 'include' });\n          const serverList = await serverRes.json().catch(() => []);\n          const serverMapped: Project[] = Array.isArray(serverList)\n            ? serverList.map((p: Record<string, unknown>, i: number) => {\n                const rec = p as { id?: unknown; title?: unknown; url?: unknown; description?: unknown; tags?: unknown; imageUrl?: unknown };\n                const tags = Array.isArray(rec.tags) ? (rec.tags as unknown[]).map(String) : [];\n                return {\n                  id: String(rec.id ?? `srv-${i}`),\n                  title: String(rec.title ?? ''),\n                  url: String(rec.url ?? ''),\n                  description: String(rec.description ?? ''),\n                  tags,\n                  imageUrl: rec.imageUrl ? String(rec.imageUrl) : '',\n                  source: 'server' as const,\n                };\n              })\n            : [];\n          setItems((prev) => [\n            ...serverMapped,\n            ...prev.filter((i) => i.source !== 'server' && i.source !== 'default'),\n            ...prev.filter((i) => i.source === 'default'),\n          ]);\n          setToast({ message: `Imported ${j?.imported ?? ''} to server`, type: 'success' });\n        } else {\n          // Not admin: keep local-only import\n          const list = Array.isArray(imported) ? (imported as Project[]) : [];\n          const next = [...list, ...items.filter((i) => i.source !== 'local')];\n          setItems(next);\n          saveLocal(next);\n          setToast({ message: `Imported ${list.length} locally`, type: 'info' });\n        }\n      } catch (err) {\n        alert('Failed to import projects. Please check the file format.');\n      }\n    };\n    reader.readAsText(file);\n    // Reset input so same file can be imported again\n    e.target.value = '';\n  }, [isAdmin, importToServer, items, saveLocal]);\n\n  return (\n    <section className=\"space-y-6\" id=\"projects\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <h2 className=\"text-2xl font-bold text-white\">Featured Projects</h2>\n        <div className=\"flex gap-3\">\n          {isAdmin ? (\n            <>\n              <Button\n                onClick={() => {\n                  if (showForm) {\n                    handleCancelEdit();\n                  } else {\n                    setShowForm(true);\n                  }\n                }}\n                variant=\"primary\"\n              >\n                {showForm ? \"‚úï Close\" : \"+ Add Project\"}\n              </Button>\n              <Button onClick={handleClearLocal} variant=\"secondary\" title=\"Remove all local projects from this browser\">\n                Clear Local\n              </Button>\n              <Button onClick={handleExport} variant=\"secondary\" title=\"Export projects to JSON file\">\n                üì• Export\n              </Button>              {isAdmin && (\n                <label class=\"flex items-center gap-2 text-xs text-slate-300 px-2 py-1 border border-slate-700 rounded\">\n                  <input\n                    type=\"checkbox\"\n                    class=\"accent-blue-500\"\n                    checked={importToServer}\n                    onChange={(e) => setImportToServer(e.target.checked)}\n                  />\n                  Import to server\n                </label>\n              )}\n              <Button as=\"label\" variant=\"secondary\" title=\"Import projects from JSON file\" className=\"cursor-pointer\">\n                üì§ Import\n                <input\n                  type=\"file\"\n                  accept=\".json\"\n                  onChange={handleImport}\n                  className=\"hidden\"\n                  aria-label=\"Import projects\"\n                />\n              </Button>\n              <Button onClick={handleLogout} variant=\"danger\">\n                Logout\n              </Button>\n            </>\n          ) : (\n            <Button onClick={() => setShowAdminLogin(true)} variant=\"secondary\">\n              üîê Admin Login\n            </Button>\n          )}\n        </div>\n      </div>\n\n      <ErrorBoundary>\n        {showAdminLogin && !isAdmin && (\n          <AdminLogin\n            onLogin={handleLogin}\n            onCancel={() => setShowAdminLogin(false)}\n          />\n        )}\n      </ErrorBoundary>\n\n      <ErrorBoundary>\n        {showForm && (\n          <ProjectForm\n            editingId={editingProject?.id || null}\n            initialTitle={editingProject?.title}\n            initialUrl={editingProject?.url}\n            initialDescription={editingProject?.description}\n            initialTags={editingProject?.tags.join(\", \")}\n            initialImages={editingProject?.images || (editingProject?.imageUrl ? [editingProject.imageUrl] : [])}\n            onSave={handleSaveProject}\n            onCancel={handleCancelEdit}\n            onSaveToSheets={handleSaveToSheets}\n          />\n        )}\n      </ErrorBoundary>\n\n      <ErrorBoundary>\n        <DndContext\n          sensors={sensors}\n          collisionDetection={closestCenter}\n          onDragEnd={handleDragEnd}\n        >\n          <SortableContext items={items.map(p => p.id)} strategy={verticalListSortingStrategy}>\n            <div className=\"grid sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {items.map((p) => (\n                <MemoizedSortableProjectCard\n                  key={p.id}\n                  project={p}\n                  isAdmin={isAdmin}\n                  onEdit={handleEdit}\n                  onDelete={handleDelete}\n                />\n              ))}\n            </div>\n          </SortableContext>\n        </DndContext>\n      </ErrorBoundary>\n\n      {isAdmin ? (\n        <div className=\"text-xs text-slate-400\">\n          You‚Äôre logged in. New projects save to the server.\n        </div>\n      ) : null}\n\n      {toast && (\n        <Toast message={toast.message} type={toast.type} onClose={() => setToast(null)} />\n      )}\n    </section>\n  );\n}\n\r\n","usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\components\\Toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\config\\version.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\data\\projects.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\lib\\constants.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\lib\\db.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'_request' is defined but never used.","line":4,"column":28,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\nimport type { NextRequest } from 'next/server';\n\nexport function middleware(_request: NextRequest) {\n  const response = NextResponse.next();\n\n  // Content Security Policy\n  const cspHeader = [\n    \"default-src 'self'\",\n    \"script-src 'self' 'unsafe-eval' 'unsafe-inline'\", // unsafe-inline needed for Next.js\n    \"style-src 'self' 'unsafe-inline'\", // unsafe-inline needed for Tailwind\n    \"img-src 'self' blob: data: https:\",\n    \"media-src 'self' data:\",\n    \"font-src 'self'\",\n    \"object-src 'none'\",\n    \"base-uri 'self'\",\n    \"form-action 'self'\",\n    \"frame-ancestors 'none'\",\n    \"upgrade-insecure-requests\",\n  ].join('; ');\n\n  response.headers.set('Content-Security-Policy', cspHeader);\n\n  // Additional security headers\n  response.headers.set('X-Frame-Options', 'DENY');\n  response.headers.set('X-Content-Type-Options', 'nosniff');\n  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');\n  response.headers.set('Permissions-Policy', 'camera=(), microphone=()');\n\n  return response;\n}\n\nexport const config = {\n  matcher: [\n    /*\n     * Match all request paths except for the ones starting with:\n     * - api (API routes)\n     * - _next/static (static files)\n     * - _next/image (image optimization files)\n     * - favicon.ico (favicon file)\n     */\n    '/((?!api|_next/static|_next/image|favicon.ico).*)',\n  ],\n};\n","usedDeprecatedRules":[]},{"filePath":"G:\\Users\\daveq\\qcode\\src\\types\\project.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]